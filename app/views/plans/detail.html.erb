<h4>避難計画詳細</h4>
<table class="table table-bordered">
	<tr>
		<th>日付</th>
		<th>出発地</th>
		<th>避難先</th>
		<th>距離(M)</th>
		<th>時間(分)</th>
		<th>メモ</th>
		<th></th>
	</tr>
  <tr>
		<td>
				<%= @plan.created_at.strftime('%Y/%m/%d')  %>
		</td>
		<td><%= @plan.departure %></td>
		<td><%= @plan.shelter %></td>
		<td><%= @plan.distance %></td>
		<td><%= @plan.duration/60 %></td>
		<td><%= @plan.memo %></td>
		<td>
			<%= link_to "削除", plan_path(@plan.id), method: :delete, class:'btn btn-sm btn-danger', method: :delete %>
		</td>
	</tr>  
</table>

<div class="comments">	
  <%= form_for @comment, url: '#', html: { class: 'form js-form' } do |f| %>
    <%= f.text_area :content, {}, { class:'form_text_area js-form_text-area comment', id: current_user.id }, style:'width: 100%; height: 100px;'  %>
    <%= f.submit "コメントする", class:'form_submit js-submit btn btn-sm btn-primary' %>
  <% end %>
	<ul class="comments">
		<%= render @comments %>
	</ul>
</div>
    <%= @plan.comments.each do |comment| %>
      <li class="comment">
        <div class="avatar">
          <%= attachment_image_tag @user.profile_image, :profile_image, :fill, 60, 60, format:'png' %>
        </div>
    <% end %>        
<script>
	$(document).ready(function() {
		function buildHTML(comment) {
			var html = $('<li class="comment">').append(comment.content);
			return html;
		}
		$('.js-form').on('submit', function(e){
			e.preventDefault();
			var textArea = $('.js-form_text-area');
			var comment = textArea.val();
			$.ajax({
				type: 'POST',
				url: '/plans/:plan_id/comments',
				data: {
					comment: {
						content: comment
						user_id: $(this).(.comment).attr('id')
						plan_id: @plan.id
				},
				dataType: 'json'
			})
			.done(function(data){
				var html = buildHTML(data);
				&('.comments').append(html);
				textArea.val('');
			})
			.fail(function() {
				alert('コメントに失敗しました')
			});
		});
	});
</script>	
